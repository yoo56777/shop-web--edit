<!DOCTYPE html>
<!--TEST-->
<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>0.0</title>

    <!-- slide link -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
    <!-- font icon link -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <!-- css link -->
    <link rel="stylesheet" href="style.css">;
    <!-- Jquery JavaScript 文件 -->
    <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js'></script>    
</head>

<body>

<!-- header section starts -->

<header class="header">
    <!-- 此處內容在header.html -->
    <script src="header.js"></script>
</header>

<!-- header section ends -->

<!-- slider section starts -->

<div class="slider">
    <div class="carousel">
        <div class="container">
            <a target="_blank">
                <img src="image/博美1.jpg"/>
            </a>
            <a target="_blank">
                <img src="image/博美2.jpg"/>
            </a>
            <a target="_blank">
                <img src="image/博美3.jpg"/>
            </a>
        </div>
        <div class="bottom"></div>
    </div>
</div>

<!-- slider section ends -->

<!-- home section starts -->

 <section class="home" id="home">

    <div class="content">
        <h3>fresh and <span>organic</span> products for your</h3>
        <p>Lorem, ipsum dolor sit amet consectetur adipisicing elit. Aliquam Libero nostrum
        veniam facere tempore nisi.</p>
        <a href="#products" class="btn">查看優惠商品</a>
    </div>
 </section>

<!-- home section ends -->

<!-- products section starts -->

<section class="products" id="products">
    <h1 class="heading"> <span>優惠商品</span> </h1>

    <!-- <div class="swiper product-slider">

        <div class="swiper-wrapper">

            <div class="swiper-slide box">
                <p style="display: none;">1</p>
                <img src="image/product1.jpg" alt="">
                <h3>watermalon</h3>
                <div class="price"> $ 100 </div>
                <button class="btn addCartBtn" onclick="addCartBtn(this)">add to cart</button>
            </div>

            <div class="swiper-slide box">
                <p style="display: none;">2</p>
                <img src="image/product2.jpg" alt="">
                <h3>onion</h3>
                <div class="price"> $ 100 </div>
                <button class="btn addCartBtn" onclick="addCartBtn(this)">add to cart</button>
            </div>

            <div class="swiper-slide box">
                <p style="display: none;">3</p>
                <img src="image/product3.jpg" alt="">
                <h3>chicken</h3>
                <div class="price"> $ 100 </div>
                <button class="btn addCartBtn" onclick="addCartBtn(this)">add to cart</button>
            </div>

            <div class="swiper-slide box">
                <p style="display: none;">4</p>
                <img src="image/product4.jpg" alt="">
                <h3>cabbage</h3>
                <div class="price"> $ 100 </div>
                <button class="btn addCartBtn" onclick="addCartBtn(this)">add to cart</button>
            </div>
        
        </div>
    
    </div>

    <div class="swiper product-slider">

        <div class="swiper-wrapper">

            <div class="swiper-slide box">
                <p style="display: none;">5</p>
                <img src="image/product5.jpg" alt="">
                <h3>potato</h3>
                <div class="price"> $ 100 </div>
                <button class="btn addCartBtn" onclick="addCartBtn(this)">add to cart</button>
            </div>

            <div class="swiper-slide box">
                <p style="display: none;">6</p>
                <img src="image/product6.jpg" alt="">
                <h3>avocado</h3>
                <div class="price"> $ 100</div>
                <button class="btn addCartBtn" onclick="addCartBtn(this)">add to cart</button>
            </div>

            <div class="swiper-slide box">
                <p style="display: none;">7</p>
                <img src="image/product7.jpg" alt="">
                <h3>carrot</h3>
                <div class="price"> $ 100 </div>
                <button class="btn addCartBtn" onclick="addCartBtn(this)">add to cart</button>
            </div>

            <div class="swiper-slide box">
                <p style="display: none;">8</p>
                <img src="image/product8.jpg" alt="">
                <h3>green lemon</h3>
                <div class="price"> $ 100 </div>
                <button class="btn addCartBtn" onclick="addCartBtn(this)">add to cart</button>
            </div>
        
        </div>
    
    </div> -->

</section>

<!-- products section ends -->

<!-- categories section starts -->

<section class="categories" id="categories">

    <h1 class="heading"> <span>商品分類</span> </h1>

    <div class="box-container" id="tags">

        <!-- <div class="box">
            <img src="image/categories1.jpg" alt="">
            <h3>vegetables</h3>
            <p>upto 45% off</p>
            <a href="product-page.html?tag=蔬菜" class="btn">shop now</a>
        </div>

        <div class="box">
            <img src="image/categories2.jpg" alt="">
            <h3>fresh fruits</h3>
            <p>upto 45% off</p>
            <a href="product-page.html?tag=水果" class="btn">shop now</a>
        </div>

        <div class="box">
            <img src="image/categories3.jpg" alt="">
            <h3>dairy products</h3>
            <p>upto 45% off</p>
            <a href="product-page.html?tag=乳製品" class="btn">shop now</a>
        </div>

        <div class="box">
            <img src="image/categories4.jpg" alt="">
            <h3>fresh meat</h3>
            <p>upto 45% off</p>
            <a href="product-page.html?tag=肉品" class="btn">shop now</a>
        </div> -->

    </div>

</section>

<!-- categories section ends -->

<!-- features section starts -->

<section class="features" id="features">

    <h1 class="heading"> <span>產品特色</span> </h1>

    <div class="box-container">

        <div class="box">
            <img src="image/feature1.jpg" alt="">
            <h3>fresh and organic</h3>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Deserunt, earum!</p>
            <a href="#" class="btn">read more</a>
        </div>

        <div class="box">
            <img src="image/feature2.jpg" alt="">
            <h3>free delivery</h3>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Deserunt, earum!</p>
            <a href="#" class="btn">read more</a>
        </div>

        <div class="box">
            <img src="image/feature3.jpg" alt="">
            <h3>easy payments</h3>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Deserunt, earum!</p>
            <a href="#" class="btn">read more</a>
        </div>

    </div>

</section>

<!-- features section ends -->

<!-- footer section starts -->

<section class="footer">

    <div class="box-container">

        <div class="box">
            <h3> groco <i class="fas fa-shopping-basket"></i> </h3>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Quod officia voluptas, sed, sunt ut cum quisquam commodi repudiandae iure id odit illum exercitationem in facere quia.</p>
            <div class="share">
                <a href="#" class="fab fa-facebook-f"></a>
                <a href="#" class="fab fa-twitter"></a>
                <a href="#" class="fab fa-instagram"></a>
                <a href="#" class="fab fa-linkedin"></a>
            </div>
        </div>

        <div class="box">
            <h3>contact info</h3>
            <a href="#" class="links"> <i class="fas fa-phone"></i> +123-456-7890 </a>
            <a href="#" class="links"> <i class="fas fa-phone"></i> +111-222-3333 </a>
            <a href="#" class="links"> <i class="fas fa-envelope"></i> qwerwasd@gmail.com </a>
            <a href="#" class="links"> <i class="fas fa-map-marker-alt"></i> taipei, taiwan </a>  
        </div>
        
        <div class="box">
            <h3>quick links</h3>
            <a href="index.html#home" class="links"> <i class="fas fa-arrow-right"></i> News</a>
            <a href="index.html#products" class="links"> <i class="fas fa-arrow-right"></i> 優惠商品 </a>
            <a href="index.html#categories" class="links"> <i class="fas fa-arrow-right"></i> 商品分類 </a>
            <a href="index.html#features" class="links"> <i class="fas fa-arrow-right"></i> 產品特色 </a>
        </div>

        <div class="box">
            <h3>newsletter</h3>
            <p>subscribe for latest updates</p>
            <input type="email" placeholder="your email" class="email">
            <input type="submit" value="subscribe" class="btn">
            <img src="image/payment.jpg" class="payment-img" alt="">
        </div>

    </div>

    <div class="credit"> created by <span> syscom </span> | all rights reserved </div>

</section>

<!-- footer section ends -->



<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

<!-- js link -->
<script src="script.js"></script>
</body>
</html>

<script>
    let index = 0

    // 圖片數量
    let imageCount = document.querySelectorAll(
        ".carousel .container img"
    ).length

    const bottom = document.querySelector(".carousel .bottom")
    for (let i = 0; i < imageCount; i++) {
        const indicator = document.createElement("div")
        indicator.classList.add("indicator")
        indicator.onclick = () => setIndex(i)
    
        bottom.append(indicator)
    }

    function createAuto() {
        return setInterval(() => {
            index++
            refresh()
        }, 3000)
    }   
    // 自動滾動
    let autoTimer = createAuto()

    function refresh() {
        if (index < 0) {
            // 下標小於 0 時，設置最右的圖片
            index = imageCount - 1
        } else if (index >= imageCount) {
            // 下標超過上限時，設置最左的圖片
            index = 0
        }
    
        // 輪播框
        let carousel = document.querySelector(".carousel")
        let width = getComputedStyle(carousel).width
        width = Number(width.slice(0, -2))
    
        carousel.querySelector(".container").style.left =
            index * width * -1 + "px"
    }

    let refreshWrapper = (func) => {
        // refresh 裝飾器
        return function (...args) {
            let result = func(...args)
            refresh()
        
            // 重製自動滾動
            clearInterval(autoTimer)
            autoTimer = createAuto()
            return result
        }
    }

    refresh()
    //網頁載入完成後處理
    $(()=>{
        //查詢優惠商品
        let dataUrl = "http://127.0.0.1:9090/com/getDiscountCom"
    
        $.ajax({
            url: dataUrl,
            method: 'GET',
            dataType: 'json',
            async: true,
            contentType: 'application/json;charset=utf-8',
            cache: false,
        
            success: res => {
                let rows = Math.ceil(res.length) / 4 //有幾行，每行4個商品，無條件進位
                for (let i = 0; i < rows; i++) {
                    $('#products').append('<div class="swiper product-slider">'+
                                          '<div class="swiper-wrapper" id="swiper' + i + '">')
                    let swiper = $('#swiper' + i)
                    for (let j = 0; j < 4; j++) {
                        let num = j + i * 4
                        let item = res[num]
                        $(swiper).append('<div class="swiper-slide box">'+
                                             '<p style="display: none;">'+item.commodityID+'</p>'+
                                             '<img src="'+item.commodityImgPath+'" alt="">'+
                                             '<h3>'+item.commodityName+'</h3>'+
                                             '<div class="price"> $ '+item.commodityPrice+' </div>'+
                                             '<button class="btn addCartBtn" onclick="addCartBtn(this)">add to cart</button>'+
                                         '</div>')
                    }
                    $('#products').append('</div>'+
                                          '</div>')
                }
                swiperOn()          
            },
        
            error: err => {
                console.log(err)
            },
        });
    
        //查詢全部分類
        dataUrl = "http://127.0.0.1:9090/tag/getAll"
    
        $.ajax({
            url: dataUrl,
            method: 'GET',
            dataType: 'json',
            async: true,
            contentType: 'application/json;charset=utf-8',
            cache: false,
        
            success: res => {
                $.each(res, (i, n) => {
                    let tagImgSrc = ""
                    $.ajax({
                        url: "http://127.0.0.1:9090/com/getByTag?tag=" + n.commoditySubTag,
                        method: 'GET',
                        dataType: 'json',
                        async: false,
                        contentType: 'application/json;charset=utf-8',
                        cache: false,
                        success: res => {
                            tagImgSrc = res[0].commodityImgPath
                            $('#tags').append(
                                '<div class="box">' +
                                '<img src="' + tagImgSrc + '" alt="">' +
                                '<h3>' + n.commoditySubTag + '</h3>' +
                                '<p>upto 45% off</p>' +
                                '<a href="product-page.html?tag=' + n.commoditySubTag + '" class="btn">shop now</a>' +
                                '</div>'
                            )
                        },
                    
                        error: err => {
                            tagImgSrc = ""
                        },
                    })
                })
            },
        
            error: err => {
                console.log(err)
            },
        });
    })    
</script>